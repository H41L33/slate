# Slate Usage Reference

**For LLMs and AI Agents:** This document provides concise, structured information about using Slate to build static sites.

## Commands

### `slate build`
Build a new page from Markdown.

```bash
slate build INPUT OUTPUT [-T TEMPLATE] [-t TITLE] [-d DESCRIPTION] [-f FORMAT]
```

**Arguments:**
- `INPUT` - Markdown source file
- `OUTPUT` - Output file (extension determines format: .html, .gmi, .txt)
- `-T, --template` - Jinja2 template path (required for HTML)
- `-t, --title` - Page title override (default: first H1)
- `-d, --description` - Meta description
- `-f, --format` - Output format: html|gemini|gopher (default: html)

**Behavior:**
- Parses Markdown to semantic HTML/Gemtext/Gopher
- Applies Jinja2 template (HTML only)
- Embeds metadata comment in output for `slate update`

### `slate update`
Update an existing output file.

```bash
slate update OUTPUT_FILE [INPUT_FILE] [-T TEMPLATE] [-d DESCRIPTION]
```

**Arguments:**
- `OUTPUT_FILE` - Existing output file to update
- `INPUT_FILE` - Optional: new source file
- `-T, --template` - Optional: new template
- `-d, --description` - Optional: new description

**Behavior:**
- Reads embedded metadata from output file
- Re-renders with updated content or parameters
- Preserves creation timestamp, updates modification timestamp

### `slate rebuild`
Rebuild entire multi-page site.

```bash
slate rebuild [-s SOURCE] [-o OUTPUT] [-T TEMPLATES] [--structure {flat,tree}]
```

**Arguments:**
- `-s, --source` - Source directory containing Markdown files (default: current dir)
- `-o, --output` - Output directory for HTML files (default: same as source)
- `-T, --templates` - Directory containing templates (optional)
- `--structure` - Output structure: `flat` (mirror source) or `tree` (professional) (default: flat)

**Behavior:**
- Discovers site structure from `index.md` in source directory
- Builds all pages with navigation
- Generates RSS feeds for blog categories
- Requires YAML frontmatter in source files

---

## Frontmatter Schema

YAML frontmatter at top of Markdown files (optional for single pages, required for multi-page sites):

```yaml
---
title: string          # Page title
description: string    # Meta description
template: string       # Path to Jinja2 template
category: string       # Category name (for multi-page sites)
type: string          # "blog" or "page" (default: page)
date: YYYY-MM-DD      # Required if type: blog
author: string        # Optional, used in RSS feeds
categories: [string]  # Only for index.md - defines site categories
url: string          # Only for index.md - base URL for RSS
---
```

**Validation Rules:**
- Blog posts (`type: blog`) MUST have `date` and `title`
- Frontmatter takes precedence over CLI arguments
- YAML parsing errors cause build failure

---

## Site Structure Pattern

Multi-page sites follow this structure:

```
site-root/
├── index.md          # categories: [cat1, cat2, ...]
├── cat1.md           # Category root page
├── cat1/
│   ├── page1.md
│   ├── page2.md
│   └── feed.xml      # Auto-generated if blog posts exist
├── cat2.md
└── cat2/
    └── page3.md
```

### Output Structures

**Flat (Default):** Mirrors source structure.
- `index.md` -> `index.html`
- `cat1.md` -> `cat1.html`
- `cat1/page1.md` -> `cat1/page1.html`

**Tree (`--structure tree`):** Professional structure.
- `index.md` -> `index.html`
- `cat1.md` -> `pages/cat1.html`
- `cat1/page1.md` -> `pages/cat1/page1.html`
- RSS: `pages/cat1/feed.xml`

**Discovery Algorithm:**
1. Read `index.md` frontmatter for `categories` list
2. For each category, verify `{category}.md` exists
3. Scan `{category}/` directory for all `.md` files
4. Build dependency graph
5. Render all pages with navigation context

---

## Template Variables

### Core Variables
- `{{content}}` - Rendered Markdown content
- `{{title}}` - Page title
- `{{description}}` - Page description

### Timestamps
- `{{creation_date}}` - DD/MM/YYYY
- `{{creation_time}}` - HH:MM
- `{{modify_date}}` - DD/MM/YYYY
- `{{modify_time}}` - HH:MM

### Navigation (v0.2.0+)
- `{{nav_header}}` - HTML: links to all category roots
- `{{nav_category}}` - HTML: list of pages in current category
- `{{category_name}}` - String: current category name
- `{{breadcrumbs}}` - HTML: breadcrumb navigation

### Content Enhancements (v0.2.0+)
- `{{toc}}` - HTML: table of contents from headings
- `{{version}}` - String: Slate version

### Variable Generation
- Navigation variables populated by `build_navigation_context(site, category_name)`
- TOC generated by `generate_toc(blocks)`
- All variables optional - empty string if not available

---

## Output Formats

### HTML
- Semantic HTML5 with accessibility attributes
- Custom CSS classes: `content-*`, `callout-*`, etc.
- Jinja2 template system

### Gemtext (.gmi)
- Gemini protocol format
- Text-only, link-list structure
- No template support

### Gopher (.txt)
- Plain text with Gopher-style selectors
- No template support

---

## RSS Feed Generation

Automatic for categories containing blog posts:

**Requirements:**
- Pages must have `type: blog` in frontmatter
- Must have `date` and `title` fields
- `index.md` must have `url` field for feed URLs

**Output:**
- RSS 2.0 format
- Location: `{category}/feed.xml`
- Auto-generated during `slate rebuild`
- Sorted by date (newest first)
- Includes: title, link, description, pubDate, author, guid

---

## Footnotes

Markdown syntax:

```markdown
Text with footnote[^1].

[^1]: Footnote content here.
```

**Processing:**
- Footnote definitions extracted from content
- References converted to superscript links
- Footnotes rendered at bottom with backlinks

---

## Common Workflows

### Single Page Workflow
```bash
# Initial build
slate build post.md post.html -T template.html -t "My Post"

# Update after edits
slate update post.html
```

### Multi-Page Site Workflow
```bash
# Initial setup
mkdir my-site && cd my-site
# Create index.md with categories frontmatter
# Create category root pages  
# Create content in category folders

# Build entire site
slate rebuild

# After editing any .md file
slate rebuild  # Rebuilds only changed files (future feature)
```

### Programmatic Usage
```python
from slate.parse import parse_markdown_to_dicts
from slate.render import HTMLRenderer
from slate.frontmatter import extract_frontmatter

# Parse Markdown
md_text = Path("post.md").read_text()
frontmatter, content = extract_frontmatter(md_text)
blocks = parse_markdown_to_dicts(content)

# Render
renderer = HTMLRenderer()
html = renderer.render_blocks(blocks, title=frontmatter.get("title"))
```

---

## Error Handling

**Common Errors:**
- Missing `index.md` → "Site root not found"
- Missing category root page → "Category root missing: {name}"
- Blog post without date/title → "Blog posts require fields: date, title"
- Invalid YAML → "Invalid frontmatter YAML: {error}"
- Missing template → "Template not found: {path}"

**Exit Codes:**
- 0 = Success
- 1 = Error (check stderr for message)

---

## Performance Characteristics

- Single page build: <100ms for typical page
- Multi-page rebuild: ~10-50ms per page
- No caching (stateless operation)
- Memory usage: O(site size)
- Bottleneck: Template rendering, not parsing

---

## Extension Points

**Parser:** `slate.parse.parse_markdown_to_dicts`
- Returns list of block dictionaries
- Easy to add new block types

**Renderer:** `slate.render.VariableRegistry`
- Register custom template variables
- Hook into rendering pipeline

**Template:** Standard Jinja2
- Full Jinja2 feature set available
- Include/extend supported

---

## Version Compatibility

- v0.1.x: Single-page builds only
- v0.2.0+: Multi-page site management
- Fully backwards compatible
- No breaking changes from v0.1.x → v0.2.0
